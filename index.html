<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Design your dream engagement ring">
    <title>For Maria üíç</title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Montserrat:wght@300;400;500;600&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay hidden">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <p class="loading-text">Creating your dream ring...</p>
        </div>
    </div>

    <!-- Screen 1: Landing Page -->
    <section id="landingScreen" class="screen active">
        <div class="container">
            <div class="landing-content">
                <h1 class="landing-title fade-in">Maria</h1>
                <p class="landing-subtitle fade-in-delay">Design Your Forever Ring</p>
                <p class="landing-description fade-in-delay-2">
                    This moment is yours to create something as unique and beautiful as our love.
                    Choose a design that speaks to your heart, or dream up something entirely your own.
                </p>
                <button class="btn btn-primary fade-in-delay-3" onclick="app.showScreen('designerScreen')">
                    Begin Your Journey
                </button>
            </div>
        </div>
        <div class="landing-particles"></div>
    </section>

    <!-- Screen 2: AI Designer with Live Preview -->
    <section id="designerScreen" class="screen">
        <div class="container">
            <button class="btn-back" onclick="app.showScreen('landingScreen')">‚Üê Back</button>
            <h2 class="screen-title">Design Your Dream Ring</h2>

            <!-- Designer Layout: Preview + Form -->
            <div class="designer-layout">
                <!-- Left Column: Preview -->
                <div class="preview-column">
                    <!-- Live Preview Panel -->
                    <div class="live-preview-panel">
                        <div class="preview-ring-image" id="livePreviewContainer">
                            <img id="livePreviewImage" src="" alt="Ring preview">
                            <div class="preview-placeholder" id="previewPlaceholder">
                                <span class="placeholder-icon">üíç</span>
                                <p>Your ring preview will appear here</p>
                            </div>
                        </div>
                        <div class="preview-caption" id="previewCaption"></div>
                    </div>
                </div>

                <!-- Unified Design Form Panel -->
                <div class="designer-form-panel">
                    <!-- Initial Design Flow (shown before first generation) -->
                    <div class="design-flow" id="designFlow">

                        <!-- Unified Design Section -->
                        <div class="flow-section">
                            <div class="flow-header">
                                <h3 class="flow-title">Describe Your Vision</h3>
                            </div>

                            <div class="designer-form">
                                <textarea
                                    id="ringDescription"
                                    placeholder="What does your dream ring look like? Tap keywords below or describe freely..."
                                    maxlength="500"
                                    rows="3"
                                ></textarea>
                                <!-- Generate Button - Primary Action -->
                                <div class="generate-section">
                                    <button class="btn btn-primary btn-generate" onclick="app.generateRing()" id="generateBtn">
                                        Create My Ring ‚ú®
                                    </button>
                                </div>

                                <!-- Ring Guide Tabs -->
                                <div class="ring-guide-tabs" id="ringGuideTabs">
                                    <p class="guide-intro">Tap to explore & add:</p>

                                    <!-- Tab Bar -->
                                    <div class="guide-tab-bar" role="tablist">
                                        <button class="guide-tab active" id="tab-diamond" role="tab" aria-selected="true" aria-controls="panel-diamond" data-category="diamond">
                                            <span class="tab-icon">üíé</span>
                                            <span class="tab-label">Diamond</span>
                                            <span class="tab-badge" id="badge-diamond"></span>
                                        </button>
                                        <button class="guide-tab" id="tab-setting" role="tab" aria-selected="false" aria-controls="panel-setting" data-category="setting">
                                            <span class="tab-icon">üíç</span>
                                            <span class="tab-label">Setting</span>
                                            <span class="tab-badge" id="badge-setting"></span>
                                        </button>
                                        <button class="guide-tab" id="tab-metal" role="tab" aria-selected="false" aria-controls="panel-metal" data-category="metal">
                                            <span class="tab-icon">‚ú®</span>
                                            <span class="tab-label">Metal</span>
                                            <span class="tab-badge" id="badge-metal"></span>
                                        </button>
                                        <button class="guide-tab" id="tab-accents" role="tab" aria-selected="false" aria-controls="panel-accents" data-category="accents">
                                            <span class="tab-icon">üåü</span>
                                            <span class="tab-label">Accents</span>
                                            <span class="tab-badge" id="badge-accents"></span>
                                        </button>
                                    </div>

                                    <!-- Tab Panels -->
                                    <div class="guide-panels">
                                        <div class="guide-panel active" id="panel-diamond" role="tabpanel" aria-labelledby="tab-diamond">
                                            <div class="guide-chips" id="guideShapesTabs"></div>
                                        </div>
                                        <div class="guide-panel" id="panel-setting" role="tabpanel" aria-labelledby="tab-setting" hidden>
                                            <div class="guide-chips" id="guideSettingsTabs"></div>
                                        </div>
                                        <div class="guide-panel" id="panel-metal" role="tabpanel" aria-labelledby="tab-metal" hidden>
                                            <div class="guide-chips" id="guideMetalsTabs"></div>
                                        </div>
                                        <div class="guide-panel" id="panel-accents" role="tabpanel" aria-labelledby="tab-accents" hidden>
                                            <div class="guide-chips" id="guideAccentsTabs"></div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Inline Reference Image (Optional) -->
                                <div class="inline-reference" id="inlineReference">
                                    <!-- Reference Preview (shown when image added) -->
                                    <div class="inline-reference-preview" id="referencePreview" style="display: none;">
                                        <img id="referenceImage" src="" alt="Reference ring">
                                        <div class="reference-actions">
                                            <button class="btn-start-with-image" onclick="app.startWithUploadedImage()">
                                                Start with this exact ring ‚ú®
                                            </button>
                                            <span class="reference-or">or add description above</span>
                                        </div>
                                        <button class="btn-remove-inline" onclick="app.clearReference()">√ó</button>
                                    </div>

                                    <!-- Reference Options (shown when no image) -->
                                    <div class="inline-reference-options" id="referenceOptions">
                                        <label class="btn-upload-block" for="ringFileInput">
                                            <span class="upload-icon">üì∑</span>
                                            <span class="upload-text">Upload inspiration photo</span>
                                            <input
                                                type="file"
                                                id="ringFileInput"
                                                accept="image/*"
                                                class="file-input-hidden"
                                            >
                                        </label>
                                        <div class="browse-links">
                                            <span class="browse-label">Browse for ideas:</span>
                                            <a href="https://www.tiffany.com/engagement/engagement-rings/" target="_blank" rel="noopener">Tiffany</a>
                                            <span class="browse-dot">¬∑</span>
                                            <a href="https://www.cartier.com/en-us/jewelry/engagement-rings/" target="_blank" rel="noopener">Cartier</a>
                                            <span class="browse-dot">¬∑</span>
                                            <a href="https://www.harrywinston.com/en/fine-jewelry/engagement-rings" target="_blank" rel="noopener">Harry Winston</a>
                                            <span class="browse-dot">¬∑</span>
                                            <a href="https://www.vancleefarpels.com/us/en/collections/engagement/diamond-sets.html?category=ring" target="_blank" rel="noopener">Van Cleef</a>
                                            <span class="browse-dot">¬∑</span>
                                            <a href="https://www.graff.com/us-en/engagement-bridal/engagement/engagement-rings/" target="_blank" rel="noopener">Graff</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>

                    <!-- Conversation Mode (shown after first generation) -->
                    <div class="conversation-mode" id="conversationMode" style="display: none;">
                        <!-- Conversation History -->
                        <div class="conversation-history" id="conversationHistory">
                            <!-- Messages will be inserted here -->
                        </div>

                        <!-- Refinement Input -->
                        <div class="refinement-input" id="refinementInput">
                            <div class="refinement-form">
                                <input
                                    type="text"
                                    id="refinementText"
                                    placeholder="Refine: 'make it more delicate' or 'add sapphire accents'..."
                                    maxlength="200"
                                >
                                <button class="btn btn-primary btn-refine" onclick="app.refineDesign()">
                                    Refine ‚ú®
                                </button>
                            </div>
                            <div class="refinement-actions">
                                <button class="btn btn-secondary" onclick="app.selectCurrentDesign()">
                                    I Love This! üíï
                                </button>
                                <button class="btn btn-save-collection" onclick="app.saveCurrentToCollection()">
                                    Save to Collection üíé
                                </button>
                                <button class="btn-reset" onclick="app.startOver()">
                                    Start Over
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Floating Collection Button -->
        <button class="collection-fab" id="collectionFab" onclick="app.openCollectionModal()">
            üíé <span id="collectionFabCount">0</span>
        </button>

        <!-- Collection Modal -->
        <div class="collection-modal" id="collectionModal">
            <div class="collection-modal-content">
                <div class="collection-modal-header">
                    <h3>üíé My Collection</h3>
                    <button class="btn-close-modal" onclick="app.closeCollectionModal()">‚úï</button>
                </div>
                <div class="collection-modal-body">
                    <div class="collection-grid" id="collectionGrid">
                        <!-- Rings will be dynamically inserted here -->
                    </div>
                    <div class="collection-empty" id="collectionEmpty">
                        <span class="empty-icon">üíç</span>
                        <p>No rings saved yet</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Screen 5: Preview & Confirmation -->
    <section id="previewScreen" class="screen">
        <div class="container">
            <h2 class="screen-title">Your Perfect Ring</h2>
            <p class="screen-subtitle">Take a moment to imagine this on your hand...</p>

            <div class="preview-content">
                <div class="preview-image-container">
                    <img id="previewImage" src="" alt="Your ring design">
                </div>

                <div class="preview-details">
                    <h3>Design Details</h3>
                    <p id="previewDescription"></p>

                    <div class="preview-actions">
                        <button class="btn btn-primary" onclick="app.confirmDesign()">
                            This is Perfect! üíï
                        </button>
                        <button class="btn btn-secondary" onclick="app.goBack()">
                            Let me revise
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Screen 6: Thank You / Confirmation -->
    <section id="thankYouScreen" class="screen">
        <div class="container">
            <div class="thankyou-content">
                <div class="thankyou-icon">üíç</div>
                <h2 class="thankyou-title">Your Design Has Been Saved!</h2>
                <p class="thankyou-message">
                    Maria, your beautiful choice has been captured.
                    This ring will be crafted with all the love and care you deserve.
                    I can't wait to see it on your hand and hear you say yes.
                </p>
                <div class="thankyou-ring-preview">
                    <img id="finalRingImage" src="" alt="Your chosen ring">
                </div>
                <p class="thankyou-note">
                    All the love in the world,<br>
                    <span class="signature">Forever Yours</span>
                </p>
            </div>
        </div>
    </section>

    <!-- Scripts -->
    <script src="config.js"></script>
    <script src="js/fal-api.js"></script>
    <script src="js/firebase-client.js"></script>
    <script src="js/main.js"></script>
</body>
</html>
